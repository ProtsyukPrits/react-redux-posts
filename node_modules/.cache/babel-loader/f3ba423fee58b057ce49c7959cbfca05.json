{"ast":null,"code":"import _asyncToGenerator from\"/home/dmytro/react-redux-posts/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _regeneratorRuntime from\"/home/dmytro/react-redux-posts/node_modules/@babel/runtime/regenerator/index.js\";import{createAsyncThunk}from\"@reduxjs/toolkit\";import axios from\"axios\";import Notiflix from'notiflix';axios.defaults.baseURL='https://connections-api.herokuapp.com/';var setAuthHeader=function setAuthHeader(token){axios.defaults.headers.common.Authorization=\"Bearer \".concat(token);};var clearAuthHeader=function clearAuthHeader(){axios.defaults.headers.common.Authorization='';};export var register=createAsyncThunk('auth/register',/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(credentials){var res;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return axios.post('/users/signup',credentials);case 3:res=_context.sent;setAuthHeader(res.data.token);return _context.abrupt(\"return\",res.data);case 8:_context.prev=8;_context.t0=_context[\"catch\"](0);return _context.abrupt(\"return\",Notiflix.Notify.info('We have some error, please try again. Maybe you need correct  you email ;)'));case 11:case\"end\":return _context.stop();}}},_callee,null,[[0,8]]);}));return function(_x){return _ref.apply(this,arguments);};}());//\nexport var logIn=createAsyncThunk('auth/login',/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(credentials){var res;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.prev=0;_context2.next=3;return axios.post('/users/login',credentials);case 3:res=_context2.sent;setAuthHeader(res.data.token);return _context2.abrupt(\"return\",res.data);case 8:_context2.prev=8;_context2.t0=_context2[\"catch\"](0);return _context2.abrupt(\"return\",Notiflix.Notify.info('We have some error, please try again!!!'));case 11:case\"end\":return _context2.stop();}}},_callee2,null,[[0,8]]);}));return function(_x2){return _ref2.apply(this,arguments);};}());//\nexport var logOut=createAsyncThunk('auth/logout',/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(_,thunkAPI){return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.prev=0;clearAuthHeader();_context3.next=7;break;case 4:_context3.prev=4;_context3.t0=_context3[\"catch\"](0);return _context3.abrupt(\"return\",thunkAPI.rejectWithValue(_context3.t0.message));case 7:case\"end\":return _context3.stop();}}},_callee3,null,[[0,4]]);}));return function(_x3,_x4){return _ref3.apply(this,arguments);};}());//\nexport var refresh=createAsyncThunk('auth/refresh',/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(_,thunkAPI){var state,persistedToken,res;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:state=thunkAPI.getState();persistedToken=state.auth.token;if(!(persistedToken===null)){_context4.next=4;break;}return _context4.abrupt(\"return\",thunkAPI.rejectWithValue('Unable to fetch user'));case 4:_context4.prev=4;setAuthHeader(persistedToken);_context4.next=8;return axios.get('/users/current');case 8:res=_context4.sent;return _context4.abrupt(\"return\",res.data);case 12:_context4.prev=12;_context4.t0=_context4[\"catch\"](4);return _context4.abrupt(\"return\",thunkAPI.rejectWithValue(_context4.t0.message));case 15:case\"end\":return _context4.stop();}}},_callee4,null,[[4,12]]);}));return function(_x5,_x6){return _ref4.apply(this,arguments);};}());","map":{"version":3,"sources":["/home/dmytro/react-redux-posts/src/redux/auth/operations.js"],"names":["createAsyncThunk","axios","Notiflix","defaults","baseURL","setAuthHeader","token","headers","common","Authorization","clearAuthHeader","register","credentials","post","res","data","Notify","info","logIn","logOut","_","thunkAPI","rejectWithValue","message","refresh","state","getState","persistedToken","auth","get"],"mappings":"2OAAA,OAASA,gBAAT,KAAiC,kBAAjC,CACA,MAAOC,CAAAA,KAAP,KAAkB,OAAlB,CACA,MAAOC,CAAAA,QAAP,KAAqB,UAArB,CAGAD,KAAK,CAACE,QAAN,CAAeC,OAAf,CAAyB,wCAAzB,CAEC,GAAMC,CAAAA,aAAa,CAAG,QAAhBA,CAAAA,aAAgB,CAAAC,KAAK,CAAI,CAC9BL,KAAK,CAACE,QAAN,CAAeI,OAAf,CAAuBC,MAAvB,CAA8BC,aAA9B,kBAAwDH,KAAxD,EACD,CAFA,CAIA,GAAMI,CAAAA,eAAe,CAAG,QAAlBA,CAAAA,eAAkB,EAAM,CAC7BT,KAAK,CAACE,QAAN,CAAeI,OAAf,CAAuBC,MAAvB,CAA8BC,aAA9B,CAA8C,EAA9C,CACD,CAFA,CAID,MAAO,IAAME,CAAAA,QAAQ,CAAGX,gBAAgB,CACtC,eADsC,0FAEtC,iBAAOY,WAAP,gKAEsBX,CAAAA,KAAK,CAACY,IAAN,CAAW,eAAX,CAA4BD,WAA5B,CAFtB,QAEUE,GAFV,eAGIT,aAAa,CAACS,GAAG,CAACC,IAAJ,CAAST,KAAV,CAAb,CAHJ,gCAIWQ,GAAG,CAACC,IAJf,0FAMWb,QAAQ,CAACc,MAAT,CAAgBC,IAAhB,CAAqB,4EAArB,CANX,sEAFsC,+DAAjC,CAaP;AAEA,MAAO,IAAMC,CAAAA,KAAK,CAAGlB,gBAAgB,CACnC,YADmC,2FAEnC,kBAAOY,WAAP,sKAEsBX,CAAAA,KAAK,CAACY,IAAN,CAAW,cAAX,CAA2BD,WAA3B,CAFtB,QAEUE,GAFV,gBAGIT,aAAa,CAACS,GAAG,CAACC,IAAJ,CAAST,KAAV,CAAb,CAHJ,iCAIWQ,GAAG,CAACC,IAJf,8FAMWb,QAAQ,CAACc,MAAT,CAAgBC,IAAhB,CAAqB,yCAArB,CANX,wEAFmC,iEAA9B,CAaP;AAEA,MAAO,IAAME,CAAAA,MAAM,CAAGnB,gBAAgB,CACpC,aADoC,2FAEpC,kBAAOoB,CAAP,CAAUC,QAAV,uIAEIX,eAAe,GAFnB,mHAIWW,QAAQ,CAACC,eAAT,CAAyB,aAAMC,OAA/B,CAJX,uEAFoC,qEAA/B,CAYP;AAEA,MAAO,IAAMC,CAAAA,OAAO,CAAGxB,gBAAgB,CACrC,cADqC,2FAErC,kBAAOoB,CAAP,CAAUC,QAAV,mJACQI,KADR,CACgBJ,QAAQ,CAACK,QAAT,EADhB,CAEQC,cAFR,CAEyBF,KAAK,CAACG,IAAN,CAAWtB,KAFpC,MAIMqB,cAAc,GAAK,IAJzB,4DAKWN,QAAQ,CAACC,eAAT,CAAyB,sBAAzB,CALX,0BASIjB,aAAa,CAACsB,cAAD,CAAb,CATJ,uBAUsB1B,CAAAA,KAAK,CAAC4B,GAAN,CAAU,gBAAV,CAVtB,QAUUf,GAVV,iDAWWA,GAAG,CAACC,IAXf,gGAaWM,QAAQ,CAACC,eAAT,CAAyB,aAAMC,OAA/B,CAbX,yEAFqC,qEAAhC","sourcesContent":["import { createAsyncThunk } from \"@reduxjs/toolkit\";\nimport axios from \"axios\";\nimport Notiflix from 'notiflix';\n\n\naxios.defaults.baseURL = 'https://connections-api.herokuapp.com/';\n\n const setAuthHeader = token => {\n  axios.defaults.headers.common.Authorization = `Bearer ${token}`;\n};\n\n const clearAuthHeader = () => {\n  axios.defaults.headers.common.Authorization = '';\n} \n\nexport const register = createAsyncThunk(\n  'auth/register',\n  async (credentials) => {\n    try {\n      const res = await axios.post('/users/signup', credentials);\n      setAuthHeader(res.data.token);\n      return res.data;\n    } catch (error) {\n      return Notiflix.Notify.info('We have some error, please try again. Maybe you need correct  you email ;)')\n    }\n  }\n)\n\n//\n\nexport const logIn = createAsyncThunk(\n  'auth/login',\n  async (credentials) => {\n    try {\n      const res = await axios.post('/users/login', credentials);\n      setAuthHeader(res.data.token);\n      return res.data;\n    } catch (error) {\n      return Notiflix.Notify.info('We have some error, please try again!!!');\n    }\n  }\n)\n\n//\n\nexport const logOut = createAsyncThunk(\n  'auth/logout',\n  async (_, thunkAPI) => {\n    try {\n      clearAuthHeader();\n    } catch (error) {\n      return thunkAPI.rejectWithValue(error.message);\n    }\n  }\n)\n\n\n//\n\nexport const refresh = createAsyncThunk(\n  'auth/refresh',\n  async (_, thunkAPI) => {\n    const state = thunkAPI.getState();  \n    const persistedToken = state.auth.token;\n\n    if (persistedToken === null) {\n      return thunkAPI.rejectWithValue('Unable to fetch user');\n    }\n\n    try {\n      setAuthHeader(persistedToken);\n      const res = await axios.get('/users/current');\n      return res.data;\n    } catch (error) {\n      return thunkAPI.rejectWithValue(error.message);\n    }\n  }\n)\n"]},"metadata":{},"sourceType":"module"}